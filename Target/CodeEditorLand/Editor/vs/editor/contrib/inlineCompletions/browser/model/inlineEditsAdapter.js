var S=Object.defineProperty;var C=Object.getOwnPropertyDescriptor;var p=(d,i,n,t)=>{for(var e=t>1?void 0:t?C(i,n):i,a=d.length-1,l;a>=0;a--)(l=d[a])&&(e=(t?l(i,n,e):l(e))||e);return t&&e&&S(i,n,e),e},m=(d,i)=>(n,t)=>i(n,t,d);import{Disposable as I}from"../../../../../base/common/lifecycle.js";import{autorunWithStore as h,observableSignalFromEvent as x}from"../../../../../base/common/observable.js";import{IConfigurationService as P}from"../../../../../platform/configuration/common/configuration.js";import{IInstantiationService as F}from"../../../../../platform/instantiation/common/instantiation.js";import{observableConfigValue as b}from"../../../../../platform/observable/common/platformObservableUtils.js";import"../../../../browser/editorBrowser.js";import{InlineEditTriggerKind as y}from"../../../../common/languages.js";import{ILanguageFeaturesService as _}from"../../../../common/services/languageFeatures.js";let s=class extends I{constructor(n,t){super();this.instantiationService=t;s.isFirst&&(s.isFirst=!1,this.instantiationService.createInstance(o))}static ID="editor.contrib.inlineEditsAdapter";static isFirst=!0};s=p([m(1,F)],s);let o=class extends I{constructor(n,t){super();this._languageFeaturesService=n;this._configurationService=t;const e=x("didChangeSignal",this._languageFeaturesService.inlineEditProvider.onDidChange);this._register(h((a,l)=>{this._inlineCompletionInlineEdits.read(a)&&(e.read(a),l.add(this._languageFeaturesService.inlineCompletionsProvider.register("*",{provideInlineCompletions:async(c,u,D,f)=>{const E=n.inlineEditProvider.all(c),v=(await Promise.all(E.map(async r=>{const g=await r.provideInlineEdit(c,{triggerKind:y.Automatic},f);if(g)return{result:g,provider:r}}))).filter(r=>!!r);return{edits:v,items:v.map(r=>({range:r.result.range,insertText:r.result.text,command:r.result.accepted,isInlineEdit:!0}))}},freeInlineCompletions:c=>{for(const u of c.edits)u.provider.freeInlineEdit(u.result)}})))}))}static experimentalInlineEditsEnabled="editor.inlineSuggest.experimentalInlineEditsEnabled";_inlineCompletionInlineEdits=b(o.experimentalInlineEditsEnabled,!1,this._configurationService)};o=p([m(0,_),m(1,P)],o);export{o as InlineEditsAdapter,s as InlineEditsAdapterContribution};
