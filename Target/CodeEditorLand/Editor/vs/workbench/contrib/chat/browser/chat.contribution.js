var Q=Object.defineProperty;var q=Object.getOwnPropertyDescriptor;var w=(p,n,l,o)=>{for(var a=o>1?void 0:o?q(n,l):n,g=p.length-1,x;g>=0;g--)(x=p[g])&&(a=(o?x(n,l,a):x(a))||a);return o&&a&&Q(n,l,a),a},m=(p,n)=>(l,o)=>n(l,o,p);import{timeout as G}from"../../../../base/common/async.js";import{MarkdownString as d,isMarkdownString as E}from"../../../../base/common/htmlContent.js";import{Disposable as P}from"../../../../base/common/lifecycle.js";import{Schemas as D}from"../../../../base/common/network.js";import{isMacintosh as U}from"../../../../base/common/platform.js";import{registerEditorFeature as J}from"../../../../editor/common/editorFeatures.js";import*as e from"../../../../nls.js";import{AccessibleViewRegistry as A}from"../../../../platform/accessibility/browser/accessibleViewRegistry.js";import{ICommandService as K}from"../../../../platform/commands/common/commands.js";import{Extensions as X}from"../../../../platform/configuration/common/configurationRegistry.js";import{SyncDescriptor as Y}from"../../../../platform/instantiation/common/descriptors.js";import{InstantiationType as t,registerSingleton as i}from"../../../../platform/instantiation/common/extensions.js";import{IInstantiationService as T}from"../../../../platform/instantiation/common/instantiation.js";import{Registry as S}from"../../../../platform/registry/common/platform.js";import{EditorPaneDescriptor as Z}from"../../../browser/editor.js";import{Extensions as ee,WorkbenchPhase as h,registerWorkbenchContribution2 as f}from"../../../common/contributions.js";import{EditorExtensions as z}from"../../../common/editor.js";import{IEditorResolverService as te,RegisteredEditorPriority as ie}from"../../../services/editor/common/editorResolverService.js";import{LifecyclePhase as oe}from"../../../services/lifecycle/common/lifecycle.js";import{ChatAgentLocation as b,ChatAgentNameService as re,ChatAgentService as ae,IChatAgentNameService as ne,IChatAgentService as R}from"../common/chatAgents.js";import{CodeMapperService as ce,ICodeMapperService as se}from"../common/chatCodeMapperService.js";import"../common/chatColors.js";import{IChatEditingService as le}from"../common/chatEditingService.js";import{chatVariableLeader as me}from"../common/chatParserTypes.js";import{IChatService as de}from"../common/chatService.js";import{ChatService as pe}from"../common/chatServiceImpl.js";import{ChatSlashCommandService as he,IChatSlashCommandService as M}from"../common/chatSlashCommands.js";import{IChatVariablesService as W}from"../common/chatVariables.js";import{ChatWidgetHistoryService as fe,IChatWidgetHistoryService as Ce}from"../common/chatWidgetHistoryService.js";import{ILanguageModelsService as ge,LanguageModelsService as ue}from"../common/languageModels.js";import{ILanguageModelStatsService as be,LanguageModelStatsService as ve}from"../common/languageModelStats.js";import{ILanguageModelToolsService as ye,LanguageModelToolsService as xe}from"../common/languageModelToolsService.js";import{LanguageModelToolsExtensionPointHandler as V}from"../common/tools/languageModelToolsContribution.js";import{IVoiceChatService as Se,VoiceChatService as ke}from"../common/voiceChatService.js";import{ChatAccessibilityHelp as Ie}from"./actions/chatAccessibilityHelp.js";import{ChatCommandCenterRendering as L,registerChatActions as we}from"./actions/chatActions.js";import{ACTION_ID_NEW_CHAT as Ee,registerNewChatActions as Pe}from"./actions/chatClearActions.js";import{registerChatCodeBlockActions as De,registerChatCodeCompareBlockActions as Ae}from"./actions/chatCodeblockActions.js";import{registerChatContextActions as Te}from"./actions/chatContextActions.js";import{registerChatCopyActions as ze}from"./actions/chatCopyActions.js";import{registerChatDeveloperActions as Re}from"./actions/chatDeveloperActions.js";import{SubmitAction as Me,registerChatExecuteActions as We}from"./actions/chatExecuteActions.js";import{registerChatFileTreeActions as Ve}from"./actions/chatFileTreeActions.js";import{registerChatExportActions as Le}from"./actions/chatImportExport.js";import{registerMoveActions as $e}from"./actions/chatMoveActions.js";import{registerQuickChatActions as Fe}from"./actions/chatQuickInputActions.js";import{registerChatTitleActions as He}from"./actions/chatTitleActions.js";import{IChatAccessibilityService as _e,IChatCodeBlockContextProviderService as Be,IChatWidgetService as Ne,IQuickChatService as je}from"./chat.js";import{ChatAccessibilityService as Oe}from"./chatAccessibilityService.js";import{ChatEditingService as Qe}from"./chatEditingService.js";import{ChatEditor as qe}from"./chatEditor.js";import{ChatEditorInput as v,ChatEditorInputSerializer as Ge}from"./chatEditorInput.js";import{ChatGettingStartedContribution as $}from"./chatGettingStarted.js";import{agentSlashCommandToMarkdown as Ue,agentToMarkdown as Je}from"./chatMarkdownDecorationsRenderer.js";import{ChatCompatibilityNotifier as F,ChatExtensionPointHandler as H}from"./chatParticipantContributions.js";import{ChatPasteProvidersFeature as Ke}from"./chatPasteProviders.js";import{QuickChatService as Xe}from"./chatQuick.js";import{ChatResponseAccessibleView as Ye}from"./chatResponseAccessibleView.js";import{ChatVariablesService as Ze}from"./chatVariables.js";import{ChatWidgetService as et}from"./chatWidget.js";import{ChatCodeBlockContextProviderService as tt}from"./codeBlockContextProviderService.js";import"./contrib/chatContextAttachments.js";import"./contrib/chatInputCompletions.js";import"./contrib/chatInputEditorContrib.js";import"./contrib/chatInputEditorHover.js";const it=S.as(X.Configuration);it.registerConfiguration({id:"chatSidebar",title:e.localize("interactiveSessionConfigurationTitle","Chat"),type:"object",properties:{"chat.editor.fontSize":{type:"number",description:e.localize("interactiveSession.editor.fontSize","Controls the font size in pixels in chat codeblocks."),default:U?12:14},"chat.editor.fontFamily":{type:"string",description:e.localize("interactiveSession.editor.fontFamily","Controls the font family in chat codeblocks."),default:"default"},"chat.editor.fontWeight":{type:"string",description:e.localize("interactiveSession.editor.fontWeight","Controls the font weight in chat codeblocks."),default:"default"},"chat.editor.wordWrap":{type:"string",description:e.localize("interactiveSession.editor.wordWrap","Controls whether lines should wrap in chat codeblocks."),default:"off",enum:["on","off"]},"chat.editor.lineHeight":{type:"number",description:e.localize("interactiveSession.editor.lineHeight","Controls the line height in pixels in chat codeblocks. Use 0 to compute the line height from the font size."),default:0},"chat.commandCenter.enabled":{type:"boolean",tags:["experimental"],markdownDescription:e.localize("chat.commandCenter.enabled","Controls whether the command center shows a menu for chat actions (requires {0}).","`#window.commandCenter#`"),default:!1},"chat.experimental.implicitContext":{type:"boolean",description:e.localize("chat.experimental.implicitContext","Controls whether a checkbox is shown to allow the user to determine which implicit context is included with a chat participant's prompt."),deprecated:!0,default:!1},"chat.experimental.variables.editor":{type:"boolean",description:e.localize("chat.experimental.variables.editor","Enables variables for editor chat."),default:!0},"chat.experimental.variables.notebook":{type:"boolean",description:e.localize("chat.experimental.variables.notebook","Enables variables for notebook chat."),default:!0},"chat.experimental.variables.terminal":{type:"boolean",description:e.localize("chat.experimental.variables.terminal","Enables variables for terminal chat."),default:!1},"chat.experimental.detectParticipant.enabled":{type:"boolean",description:e.localize("chat.experimental.detectParticipant.enabled","Enables chat participant autodetection for panel chat."),default:null}}}),S.as(z.EditorPane).registerEditorPane(Z.create(qe,v.EditorID,e.localize("chat","Chat")),[new Y(v)]);let C=class extends P{static ID="workbench.contrib.chatResolver";constructor(n,l){super(),this._register(n.registerEditor(`${D.vscodeChatSesssion}:**/**`,{id:v.EditorID,label:e.localize("chat","Chat"),priority:ie.builtin},{singlePerResource:!0,canSupportResource:o=>o.scheme===D.vscodeChatSesssion},{createEditorInput:({resource:o,options:a})=>({editor:l.createInstance(v,o,a),options:a})}))}};C=w([m(0,te),m(1,T)],C),A.register(new Ye),A.register(new Ie);let y=class extends P{constructor(n,l,o,a,g){super(),this._store.add(n.registerSlashCommand({command:"clear",detail:e.localize("clear","Start a new chat"),sortText:"z2_clear",executeImmediately:!0,locations:[b.Panel]},async()=>{l.executeCommand(Ee)})),this._store.add(n.registerSlashCommand({command:"help",detail:"",sortText:"z1_help",executeImmediately:!0,locations:[b.Panel]},async(x,c)=>{const r=o.getDefaultAgent(b.Panel),_=o.getAgents();r?.metadata.helpTextPrefix&&(E(r.metadata.helpTextPrefix)?c.report({content:r.metadata.helpTextPrefix,kind:"markdownContent"}):c.report({content:new d(r.metadata.helpTextPrefix),kind:"markdownContent"}),c.report({content:new d(`

`),kind:"markdownContent"}));const B=(await Promise.all(_.filter(s=>s.id!==r?.id).filter(s=>s.locations.includes(b.Panel)).map(async s=>{const k=s.description?`- ${s.description}`:"",N=`- ${g.invokeFunction(u=>Je(s,!0,u))} ${k}`,j=s.slashCommands.map(u=>{const O=u.description?`- ${u.description}`:"";return`	* ${Ue(s,u)} ${O}`}).join(`
`);return(N+`
`+j).trim()}))).join(`
`);if(c.report({content:new d(B,{isTrusted:{enabledCommands:[Me.ID]}}),kind:"markdownContent"}),r?.metadata.helpTextVariablesPrefix){c.report({content:new d(`

`),kind:"markdownContent"}),E(r.metadata.helpTextVariablesPrefix)?c.report({content:r.metadata.helpTextVariablesPrefix,kind:"markdownContent"}):c.report({content:new d(r.metadata.helpTextVariablesPrefix),kind:"markdownContent"});const k=[...a.getVariables(b.Panel),{name:"file",description:e.localize("file","Choose a file in the workspace")}].map(I=>`* \`${me}${I.name}\` - ${I.description}`).join(`
`);c.report({content:new d(`
`+k),kind:"markdownContent"})}r?.metadata.helpTextPostfix&&(c.report({content:new d(`

`),kind:"markdownContent"}),E(r.metadata.helpTextPostfix)?c.report({content:r.metadata.helpTextPostfix,kind:"markdownContent"}):c.report({content:new d(r.metadata.helpTextPostfix),kind:"markdownContent"})),await G(200)}))}};y=w([m(0,M),m(1,K),m(2,R),m(3,W),m(4,T)],y);const ot=S.as(ee.Workbench);f(C.ID,C,h.BlockStartup),ot.registerWorkbenchContribution(y,oe.Eventually),S.as(z.EditorFactory).registerEditorSerializer(v.TypeID,Ge),f(H.ID,H,h.BlockStartup),f(V.ID,V,h.BlockRestore),f(F.ID,F,h.Eventually),f($.ID,$,h.Eventually),f(L.ID,L,h.AfterRestored),we(),ze(),De(),Ae(),Ve(),He(),We(),Fe(),Le(),$e(),Pe(),Te(),Re(),J(Ke),i(de,pe,t.Delayed),i(Ne,et,t.Delayed),i(je,Xe,t.Delayed),i(_e,Oe,t.Delayed),i(Ce,fe,t.Delayed),i(ge,ue,t.Delayed),i(be,ve,t.Delayed),i(M,he,t.Delayed),i(R,ae,t.Delayed),i(ne,re,t.Delayed),i(W,Ze,t.Delayed),i(ye,xe,t.Delayed),i(Se,ke,t.Delayed),i(Be,tt,t.Delayed),i(se,ce,t.Delayed),i(le,Qe,t.Delayed);
