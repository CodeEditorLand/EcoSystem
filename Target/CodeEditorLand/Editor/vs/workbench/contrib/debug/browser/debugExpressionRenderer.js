var S=Object.defineProperty;var k=Object.getOwnPropertyDescriptor;var y=(c,t,e,n)=>{for(var s=n>1?void 0:n?k(t,e):t,a=c.length-1,o;a>=0;a--)(o=c[a])&&(s=(n?o(t,e,s):o(s))||s);return n&&s&&S(t,e,s),s},d=(c,t)=>(e,n)=>t(e,n,c);import*as l from"../../../../base/browser/dom.js";import"../../../../base/browser/ui/highlightedlabel/highlightedLabel.js";import{getDefaultHoverDelegate as E}from"../../../../base/browser/ui/hover/hoverDelegateFactory.js";import{DisposableStore as H}from"../../../../base/common/lifecycle.js";import"../../../../base/common/observable.js";import{CommandsRegistry as T,ICommandService as N}from"../../../../platform/commands/common/commands.js";import{IConfigurationService as A}from"../../../../platform/configuration/common/configuration.js";import{IHoverService as R}from"../../../../platform/hover/browser/hover.js";import{IInstantiationService as w}from"../../../../platform/instantiation/common/instantiation.js";import{observableConfigValue as V}from"../../../../platform/observable/common/platformObservableUtils.js";import"../common/debug.js";import{Expression as u,ExpressionContainer as I,Variable as _}from"../common/debugModel.js";import{ReplEvaluationResult as U}from"../common/replModel.js";import"./baseDebugView.js";import{handleANSIOutput as L}from"./debugANSIHandling.js";import{COPY_EVALUATE_PATH_ID as B,COPY_VALUE_ID as $}from"./debugCommands.js";import{DebugLinkHoverBehavior as b,LinkDetector as z}from"./linkDetector.js";const P=1024,M=/^(true|false)$/i,F=/^(['"]).*\1$/;var Y=(i=>(i.Value="value",i.Unavailable="unavailable",i.Error="error",i.Changed="changed",i.Boolean="boolean",i.String="string",i.Number="number",i))(Y||{});const j=Object.keys({value:0,unavailable:0,error:0,changed:0,boolean:0,string:0,number:0});let p=class{constructor(t,e,n,s){this.commandService=t;this.hoverService=s;this.linkDetector=n.createInstance(z),this.displayType=V("debug.showVariableTypes",!1,e)}displayType;linkDetector;renderVariable(t,e,n={}){const s=this.displayType.get();if(e.available){t.type.textContent="";let o=e.name;e.value&&typeof e.name=="string"&&(e.type&&s?(o+=": ",t.type.textContent=e.type+" ="):o+=" ="),t.label.set(o,n.highlights,e.type&&!s?e.type:e.name),t.name.classList.toggle("virtual",e.presentationHint?.kind==="virtual"),t.name.classList.toggle("internal",e.presentationHint?.visibility==="internal")}else e.value&&typeof e.name=="string"&&e.name&&t.label.set(":");t.expression.classList.toggle("lazy",!!e.presentationHint?.lazy);const a=[{id:$,args:[e,[e]]}];return e.evaluateName&&a.push({id:B,args:[{variable:e}]}),this.renderValue(t.value,e,{showChanged:n.showChanged,maxValueLength:P,hover:{commands:a},colorize:!0,session:e.getSession()})}renderValue(t,e,n={}){const s=new H,a=!!n.session?.rememberedCapabilities?.supportsANSIStyling;let o=typeof e=="string"?e:e.value;for(const h of j)t.classList.remove(h);t.classList.add("value"),o===null||(e instanceof u||e instanceof _||e instanceof U)&&!e.available?(t.classList.add("unavailable"),o!==u.DEFAULT_VALUE&&t.classList.add("error")):(typeof e!="string"&&n.showChanged&&e.valueChanged&&o!==u.DEFAULT_VALUE&&(t.classList.add("changed"),e.valueChanged=!1),n.colorize&&typeof e!="string"&&(e.type==="number"||e.type==="boolean"||e.type==="string"?t.classList.add(e.type):isNaN(+o)?M.test(o)?t.classList.add("boolean"):F.test(o)&&t.classList.add("string"):t.classList.add("number"))),n.maxValueLength&&o&&o.length>n.maxValueLength&&(o=o.substring(0,n.maxValueLength)+"..."),o||(o="");const i=n.session??(e instanceof I?e.getSession():void 0),D=n.hover===!1?{type:b.Rich,store:s}:{type:b.None};l.clearNode(t);const v=n.locationReference??(e instanceof I&&e.valueLocationReference);let g=this.linkDetector;if(v&&i&&(g=this.linkDetector.makeReferencedLinkDetector(v,i)),a?t.appendChild(L(o,g,i?i.root:void 0)):t.appendChild(g.linkify(o,!1,i?.root,!0,D)),n.hover!==!1){const{commands:h=[]}=n.hover||{};s.add(this.hoverService.setupManagedHover(E("mouse"),t,()=>{const r=l.$("div"),f=l.$("div.hover-row"),m=l.append(f,l.$("div.hover-contents")),C=l.append(m,l.$("pre.debug-var-hover-pre"));return a?C.appendChild(L(o,this.linkDetector,i?i.root:void 0)):C.textContent=o,r.appendChild(f),r},{actions:h.map(({id:r,args:f})=>{const m=T.getCommand(r)?.metadata?.description;return{label:typeof m=="string"?m:m?m.value:r,commandId:r,run:()=>this.commandService.executeCommand(r,...f)}})}))}return s}};p=y([d(0,N),d(1,A),d(2,w),d(3,R)],p);export{p as DebugExpressionRenderer};
